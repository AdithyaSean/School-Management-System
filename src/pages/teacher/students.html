<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students - School Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="sidebar">
        <div class="text-center mb-4">
            <img src="../../assets/images/default-avatar.png" alt="Teacher" class="profile-image mb-2">
            <h6 class="mb-0">Welcome, Teacher</h6>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="dashboard.html"><i class="fas fa-home me-2"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-assessments.html"><i class="fas fa-tasks me-2"></i>Assessments</a></li>
            <li class="nav-item"><a class="nav-link" href="manage-exams.html"><i class="fas fa-file-alt me-2"></i>Exams</a></li>
            <li class="nav-item"><a class="nav-link" href="attendance.html"><i class="fas fa-calendar-check me-2"></i>Attendance</a></li>
            <li class="nav-item"><a class="nav-link active" href="students.html"><i class="fas fa-user-graduate me-2"></i>Students</a></li>
            <li class="nav-item mt-auto"><a class="nav-link text-danger" href="../../index.html"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
        </ul>
    </nav>
    <main class="main-content">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Student Information</h2>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-secondary" id="btnEmptyState" style="display:none">Show Empty State</button>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal" onclick="openStudentModal()"><i class="fas fa-user-plus me-2"></i>Add Student</button>
                </div>
            </div>
            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <select class="form-select" id="classFilter">
                                <option value="">All Classes</option>
                                <option>Grade 10A</option>
                                <option>Grade 11B</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchStudents" placeholder="Search students...">
                                <button class="btn btn-outline-secondary"><i class="fas fa-search"></i></button>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <div class="btn-group">
                                <button class="btn btn-outline-secondary btn-sm active" id="listViewBtn"><i class="fas fa-list"></i></button>
                                <button class="btn btn-outline-secondary btn-sm" id="gridViewBtn"><i class="fas fa-th-large"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Empty State -->
            <div id="emptyState" class="text-center p-5 border rounded mb-4" style="display:none">
                <h5 class="mb-3">No students found</h5>
                <p class="text-muted mb-4">Get started by adding your first student record.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal" onclick="openStudentModal()"><i class="fas fa-user-plus me-2"></i>Add Student</button>
            </div>
            <!-- Students List -->
            <div id="studentsContainer" class="row g-4"></div>
        </div>
    </main>
    <!-- Student Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalTitle">Add Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="studentForm" novalidate>
                        <input type="hidden" id="studentId">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="studentName" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Class</label>
                                <select class="form-select" id="studentClass" required>
                                    <option value="">Select</option>
                                    <option>Grade 10A</option>
                                    <option>Grade 11B</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="studentStatus" required>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="studentEmail" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Guardian</label>
                                <input type="text" class="form-control" id="studentGuardian" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Contact</label>
                                <input type="text" class="form-control" id="studentContact" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="studentNotes" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStudentBtn" onclick="saveStudent()">Save Student</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Performance / Attendance Drawer (offcanvas) -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="studentDetailCanvas">
        <div class="offcanvas-header">
            <h5 id="detailName">Student Detail</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div class="mb-3"><strong>Class:</strong> <span id="detailClass"></span></div>
            <div class="mb-3"><strong>Status:</strong> <span id="detailStatus" class="badge"></span></div>
            <div class="mb-3"><strong>Email:</strong> <span id="detailEmail"></span></div>
            <div class="mb-3"><strong>Guardian:</strong> <span id="detailGuardian"></span></div>
            <div class="mb-3"><strong>Contact:</strong> <span id="detailContact"></span></div>
            <div class="mb-3"><strong>Notes:</strong><br><span id="detailNotes" class="small text-muted"></span></div>
            <hr>
            <h6>Recent Performance</h6>
            <ul class="list-unstyled small" id="detailPerformance"></ul>
            <h6 class="mt-4">Attendance Snapshot</h6>
            <div class="d-flex gap-3 small" id="detailAttendance"></div>
            <div class="mt-4">
                <button class="btn btn-sm btn-outline-primary" onclick="generateStudentReport()"><i class="fas fa-file-alt me-1"></i>Performance Report</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="generateStudentAttendance()"><i class="fas fa-calendar-check me-1"></i>Attendance Report</button>
            </div>
            <div id="studentReportArea" class="mt-3"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const students = [
            {id:1,name:'John Doe',class:'Grade 10A',status:'active',email:'john@example.com',guardian:'Mary Doe',contact:'555-1234',notes:'Prefect',performance:[{s:'Math',m:88},{s:'Science',m:82}],attendance:{present:120,absent:5,late:3}},
            {id:2,name:'Jane Smith',class:'Grade 11B',status:'active',email:'jane@example.com',guardian:'Tom Smith',contact:'555-5678',notes:'Needs help in Math',performance:[{s:'Math',m:72},{s:'Science',m:90}],attendance:{present:118,absent:7,late:1}}
        ];
        let editingId=null;
        function renderStudents(){
            const container=document.getElementById('studentsContainer');
            container.innerHTML='';
            if(!students.length){document.getElementById('emptyState').style.display='block';return;} else {document.getElementById('emptyState').style.display='none';}
            students.forEach(st=>{
                const col=document.createElement('div');
                col.className='col-12';
                col.innerHTML=`<div class="card student-item" data-id="${st.id}"><div class="card-body d-md-flex justify-content-between align-items-center">`+
                    `<div class="mb-3 mb-md-0"><h6 class="mb-1">${st.name}</h6><div class="small text-muted">${st.class}</div></div>`+
                    `<div class="d-flex align-items-center gap-3 flex-wrap">`+
                    `<span class="badge bg-${st.status==='active'?'success':'secondary'}">${st.status}</span>`+
                    `<button class="btn btn-sm btn-outline-primary" onclick="viewStudent(${st.id})"><i class='fas fa-eye'></i></button>`+
                    `<button class="btn btn-sm btn-outline-warning" onclick="editStudent(${st.id})"><i class='fas fa-edit'></i></button>`+
                    `<button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${st.id})"><i class='fas fa-trash'></i></button>`+
                    `</div></div></div>`;
                container.appendChild(col);
            });
        }
        function openStudentModal(){editingId=null;document.getElementById('studentModalTitle').textContent='Add Student';document.getElementById('studentForm').reset();}
        function saveStudent(){
            const form=document.getElementById('studentForm');
            if(!form.checkValidity()){form.reportValidity();return;}
            const data={
                id: editingId|| Date.now(),
                name: studentName.value.trim(),
                class: studentClass.value,
                status: studentStatus.value,
                email: studentEmail.value.trim(),
                guardian: studentGuardian.value.trim(),
                contact: studentContact.value.trim(),
                notes: studentNotes.value.trim(),
                performance:[],attendance:{present:0,absent:0,late:0}
            };
            if(editingId){const idx=students.findIndex(s=>s.id===editingId);students[idx]=data;} else {students.push(data);}            
            bootstrap.Modal.getInstance(document.getElementById('studentModal')).hide();
            renderStudents();
            showToast('Student saved','success');
        }
        function editStudent(id){const st=students.find(s=>s.id===id);if(!st)return;editingId=id;studentModalTitle.textContent='Edit Student';studentId.value=st.id;studentName.value=st.name;studentClass.value=st.class;studentStatus.value=st.status;studentEmail.value=st.email;studentGuardian.value=st.guardian;studentContact.value=st.contact;studentNotes.value=st.notes;new bootstrap.Modal('#studentModal').show();}
        function deleteStudent(id){if(!confirm('Delete this student?'))return;const idx=students.findIndex(s=>s.id===id);if(idx>-1){students.splice(idx,1);renderStudents();showToast('Student deleted','info');}}
        function viewStudent(id){const st=students.find(s=>s.id===id);if(!st)return;detailName.textContent=st.name;detailClass.textContent=st.class;detailStatus.textContent=st.status;detailStatus.className='badge bg-' + (st.status==='active'?'success':'secondary');detailEmail.textContent=st.email;detailGuardian.textContent=st.guardian;detailContact.textContent=st.contact;detailNotes.textContent=st.notes||'-';detailPerformance.innerHTML=st.performance.map(p=>`<li>${p.s}: ${p.m}%</li>`).join('')||'<li>No data</li>';detailAttendance.innerHTML=`<div><strong>${st.attendance.present}</strong><div class='text-muted'>Present</div></div><div><strong>${st.attendance.absent}</strong><div class='text-muted'>Absent</div></div><div><strong>${st.attendance.late}</strong><div class='text-muted'>Late</div></div>`;new bootstrap.Offcanvas('#studentDetailCanvas').show();}
        function generateStudentReport(){studentReportArea.innerHTML='<div class="alert alert-primary small">Performance report placeholder (marks, averages, progress chart).</div>';}
        function generateStudentAttendance(){studentReportArea.innerHTML='<div class="alert alert-secondary small">Attendance report placeholder (monthly breakdown, trends).</div>';}
        // Filters & search
        document.getElementById('classFilter').addEventListener('change',applyFilters);
        document.getElementById('statusFilter').addEventListener('change',applyFilters);
        document.getElementById('searchStudents').addEventListener('input',applyFilters);
        function applyFilters(){const c=classFilter.value.toLowerCase(),s=statusFilter.value.toLowerCase(),q=searchStudents.value.toLowerCase();document.querySelectorAll('#studentsContainer .student-item').forEach(card=>{const id=parseInt(card.dataset.id);const st=students.find(x=>x.id===id);const matchC=!c||st.class.toLowerCase().includes(c);const matchS=!s||st.status.toLowerCase()===s;const matchQ=!q||st.name.toLowerCase().includes(q);card.parentElement.style.display=(matchC&&matchS&&matchQ)?'':'none';});}
        // List/Grid toggle
        listViewBtn.addEventListener('click',()=>{listViewBtn.classList.add('active');gridViewBtn.classList.remove('active');document.querySelectorAll('#studentsContainer .col-12').forEach(c=>c.className='col-12');});
        gridViewBtn.addEventListener('click',()=>{gridViewBtn.classList.add('active');listViewBtn.classList.remove('active');document.querySelectorAll('#studentsContainer .col-12').forEach(c=>c.className='col-sm-6 col-lg-4');});
        function showToast(msg,type='success'){const toast=document.createElement('div');toast.className='position-fixed bottom-0 end-0 p-3';toast.style.zIndex='1050';toast.innerHTML=`<div class="toast show"><div class="toast-header bg-${type} text-white"><strong class="me-auto">Notification</strong><button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button></div><div class="toast-body">${msg}</div></div>`;document.body.appendChild(toast);setTimeout(()=>toast.remove(),2500);}        
        renderStudents();
    </script>
</body>
</html>
